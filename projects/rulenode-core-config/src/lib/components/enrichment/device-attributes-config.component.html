<section [formGroup]="deviceAttributesConfigForm" class="tb-form-panel no-padding no-border">
  <div class="tb-form-panel stroked no-padding-bottom">
    <div class="tb-form-panel-title tb-required" translate>tb.rulenode.device-relations-query</div>
    <tb-device-relations-query-config
      required
      formControlName="deviceRelationsQuery">
    </tb-device-relations-query-config>
  </div>
  <div class="tb-form-panel stroked">
    <div class="tb-form-row no-padding no-border space-between">
      <div class="tb-form-panel-title tb-required" translate>tb.rulenode.related-device-attributes</div>
      <div class="tb-form-panel-hint tb-error" translate
           [hidden]="!(deviceAttributesConfigForm.get('attributesControl').touched &&
                        deviceAttributesConfigForm.get('attributesControl').hasError('atLeastOneRequired'))">
        tb.rulenode.at-least-one-field-required
      </div>
    </div>
    <tb-select-attributes (focusout)="touched()"
                          formControlName="attributesControl"
                          popupHelpLink="rulenode/related_device_attributes_node_fields_templatization"></tb-select-attributes>
    <tb-msg-metadata-chip formControlName="fetchTo"
                          [labelText]="'tb.rulenode.add-selected-attributes-to' | translate"></tb-msg-metadata-chip>
  </div>
  <div tb-hint-tooltip-icon="{{ 'tb.rulenode.tell-failure-tooltip' | translate }}"
       class="tb-form-row same-padding">
    <mat-slide-toggle class="mat-slide margin" formControlName="tellFailureIfAbsent">
      {{ 'tb.rulenode.tell-failure' | translate }}
    </mat-slide-toggle>
  </div>
</section>
